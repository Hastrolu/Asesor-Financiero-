<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0a">
    <title>Gestor Financiero Personal</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>
<body>
    <!-- PANTALLA DE PIN -->
    <div id="pinScreen" class="pin-screen active">
        <div class="pin-title">Introduce tu PIN</div>
        <div class="pin-dots" id="pinDots">
            <div class="pin-dot"></div>
            <div class="pin-dot"></div>
            <div class="pin-dot"></div>
            <div class="pin-dot"></div>
            <div class="pin-dot"></div>
            <div class="pin-dot"></div>
        </div>
        <div class="pin-keypad">
            <button class="pin-key" onclick="addPinDigit('1')">1</button>
            <button class="pin-key" onclick="addPinDigit('2')">2</button>
            <button class="pin-key" onclick="addPinDigit('3')">3</button>
            <button class="pin-key" onclick="addPinDigit('4')">4</button>
            <button class="pin-key" onclick="addPinDigit('5')">5</button>
            <button class="pin-key" onclick="addPinDigit('6')">6</button>
            <button class="pin-key" onclick="addPinDigit('7')">7</button>
            <button class="pin-key" onclick="addPinDigit('8')">8</button>
            <button class="pin-key" onclick="addPinDigit('9')">9</button>
            <button class="pin-key empty"></button>
            <button class="pin-key" onclick="addPinDigit('0')">0</button>
            <button class="pin-key delete" onclick="deletePinDigit()">‚Üê</button>
        </div>
        <div class="pin-error" id="pinError">PIN incorrecto</div>
    </div>

    <!-- APP CONTAINER -->
    <div id="appContainer" class="app-container">
    
    <!-- HEADER M√ìVIL -->
    <div class="mobile-header">
        <h1>Finanzas</h1>
    </div>
    
    <!-- STATS M√ìVIL - Ingresos y Gastos prominentes -->
    <div class="mobile-main-stats">
        <div class="mobile-stat-block">
            <div class="mobile-stat-value positive" id="mobileIncome">+0‚Ç¨</div>
            <div class="mobile-stat-label">Ingresos</div>
        </div>
        <div class="mobile-stat-block">
            <div class="mobile-stat-value negative" id="mobileExpenses">-0‚Ç¨</div>
            <div class="mobile-stat-label">Gastos</div>
        </div>
    </div>
    
    <!-- STATS SECUNDARIOS - Patrimonio y Ahorro -->
    <div class="mobile-secondary-stats">
        <div class="mobile-secondary-item">
            <div class="mobile-secondary-value" id="mobilePatrimony">0‚Ç¨</div>
            <div class="mobile-secondary-label">Patrimonio</div>
        </div>
        <div class="mobile-secondary-item">
            <div class="mobile-secondary-value" id="mobileSavings">0%</div>
            <div class="mobile-secondary-label">Ahorro</div>
        </div>
    </div>

    <header>
        <h1>GESTOR FINANCIERO</h1>
        <p class="motivational">"No te atrevas a morir pobre"</p>
    </header>

    <div class="quick-actions">
        <button class="quick-btn" onclick="openAddTransaction('income')">
            <span class="quick-icon">+</span><span>Ingreso</span>
        </button>
        <button class="quick-btn" onclick="openAddTransaction('expense')">
            <span class="quick-icon">‚àí</span><span>Gasto</span>
        </button>
    </div>

    <nav class="main-nav">
        <button class="nav-btn active" onclick="showSection('dashboard')">Dashboard</button>
        <button class="nav-btn" onclick="showSection('inversiones')">Inversiones</button>
        <button class="nav-btn" onclick="showSection('estadisticas')">Estad√≠sticas</button>
        <button class="nav-btn" onclick="showSection('datos')">Datos</button>
    </nav>

    <div class="container">
        
        <!-- DASHBOARD -->
        <div id="dashboard" class="section active">
            <div class="summary-cards">
                <div class="summary-card" onclick="showDetailsPopup('income')">
                    <div class="card-label">Ingresos del Mes</div>
                    <div class="card-value positive" id="monthlyIncome">0‚Ç¨</div>
                </div>
                <div class="summary-card" onclick="showDetailsPopup('expenses')">
                    <div class="card-label">Gastos del Mes</div>
                    <div class="card-value negative" id="monthlyExpenses">0‚Ç¨</div>
                </div>
                <div class="summary-card" onclick="showDetailsPopup('savings')">
                    <div class="card-label">Tasa de Ahorro</div>
                    <div class="card-value" id="savingsRate">0%</div>
                </div>
                <div class="summary-card" onclick="showDetailsPopup('patrimony')">
                    <div class="card-label">Patrimonio Total</div>
                    <div class="card-value highlight" id="totalPatrimony">0‚Ç¨</div>
                </div>
            </div>

            <div class="transactions-grid">
                <div class="transactions-column">
                    <div class="column-header">
                        <h2>Gastos</h2>
                        <select id="filterExpensesMonth" onchange="filterExpenses()"></select>
                    </div>
                    <div class="column-total">
                        <span>Total:</span>
                        <span class="total-amount negative" id="expensesTotal">0‚Ç¨</span>
                    </div>
                    <div id="expensesList" class="transactions-list"></div>
                </div>
                <div class="transactions-column">
                    <div class="column-header">
                        <h2>Ingresos</h2>
                        <select id="filterIncomesMonth" onchange="filterIncomes()"></select>
                    </div>
                    <div class="column-total">
                        <span>Total:</span>
                        <span class="total-amount positive" id="incomesTotal">0‚Ç¨</span>
                    </div>
                    <div id="incomesList" class="transactions-list"></div>
                </div>
            </div>
        </div>

        <!-- INVERSIONES -->
        <div id="inversiones" class="section">
            <div id="investmentSetup" class="card setup-card" style="display: none;">
                <h2>Configuraci√≥n Inicial</h2>
                <p class="setup-description">Configura tu meta de colch√≥n de emergencia</p>
                <div class="form-group">
                    <label>Meta del Colch√≥n (‚Ç¨)</label>
                    <input type="number" id="setupEmergencyGoal" placeholder="5000" step="100">
                    <small>Recomendado: 3-6 meses de gastos</small>
                </div>
                <button class="btn-primary" onclick="completeSetup()">Completar</button>
            </div>

            <div id="investmentPanel" class="investment-panel">
                <div class="investment-summary">
                    <div class="inv-card emergency-card">
                        <h3>Colch√≥n de Emergencia</h3>
                        <div class="emergency-visual">
                            <div class="emergency-bar-container">
                                <div class="emergency-bar-fill" id="emergencyBarFill"></div>
                                <div class="emergency-bar-text">
                                    <span id="emergencyCurrentText">0‚Ç¨</span>
                                    <span class="emergency-separator">/</span>
                                    <span id="emergencyGoalText">0‚Ç¨</span>
                                </div>
                            </div>
                            <div class="emergency-percent" id="emergencyPercentBig">0%</div>
                        </div>
                        <div id="emergencyCompleteMsg" class="emergency-complete" style="display: none;">üéâ ¬°Meta completada!</div>
                        <div class="inv-actions">
                            <button class="btn-secondary btn-small" onclick="editEmergencyGoal()">Editar Meta</button>
                        </div>
                    </div>
                    
                    <div class="inv-card">
                        <h3>Total Invertido</h3>
                        <div class="inv-value" id="invTotalInvested">0‚Ç¨</div>
                        <div id="investmentDistribution" class="investment-distribution"></div>
                    </div>
                    
                    <div class="inv-card">
                        <h3>Disponible</h3>
                        <div class="inv-value" id="availableThisMonth">0‚Ç¨</div>
                        <small id="availableBreakdown">Patrimonio - Invertido</small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>D√≥nde est√° invertido</h2>
                    </div>
                    <div id="investmentBubbles" class="bubbles-container"></div>
                    <p class="bubble-hint">Para a√±adir inversiones, usa "Nuevo Gasto" ‚Üí categor√≠a Inversi√≥n</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2>Categor√≠as</h2>
                        <button class="btn-secondary btn-small" onclick="addExpenseCategory()">+ A√±adir</button>
                    </div>
                    <div id="expenseCategoriesList"></div>
                </div>
            </div>
        </div>

        <!-- ESTAD√çSTICAS -->
        <div id="estadisticas" class="section">
            
            <div class="card">
                <div class="card-header">
                    <h2>Distribuci√≥n 20/15/65</h2>
                    <button class="btn-secondary btn-small" onclick="editDistributionConfig()">‚öô Configurar</button>
                </div>
                <div class="distribution-nav">
                    <button class="btn-nav" onclick="changeDistributionMonth(-1)">‚óÄ</button>
                    <span id="distributionMonthLabel">Enero 2026</span>
                    <button class="btn-nav" onclick="changeDistributionMonth(1)">‚ñ∂</button>
                </div>
                <div class="distribution-income">Ingresos del mes: <strong id="distMonthIncome">0‚Ç¨</strong></div>
                <div id="distributionGroups"></div>
            </div>

            <div class="card">
                <h2>Evoluci√≥n Mensual</h2>
                <div class="chart-container"><canvas id="evolutionChart"></canvas></div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 id="distributionChartTitle">Gastos del Mes</h2>
                    <button class="btn-secondary btn-small" id="toggleChartView" onclick="toggleChartView()">Ver Anual</button>
                </div>
                <div class="chart-nav">
                    <button class="btn-nav" onclick="changeChartPeriod(-1)">‚óÄ</button>
                    <span id="chartPeriodLabel">Enero 2026</span>
                    <button class="btn-nav" onclick="changeChartPeriod(1)">‚ñ∂</button>
                </div>
                <div class="chart-container"><canvas id="distributionChart"></canvas></div>
            </div>

            <div class="calculators-grid">
                <div class="card calculator-card">
                    <h3>Calculadora de Hipoteca</h3>
                    <div class="form-group"><label>Precio vivienda (‚Ç¨)</label><input type="number" id="housePrice" step="1000"></div>
                    <div class="form-group"><label>Entrada (‚Ç¨)</label><input type="number" id="downPayment" step="1000"></div>
                    <div class="form-group"><label>Inter√©s anual (%)</label><input type="number" id="interestRate" step="0.1"></div>
                    <div class="form-group"><label>A√±os</label><input type="number" id="years" step="1"></div>
                    <button class="btn-primary" onclick="calculateMortgage()">Calcular</button>
                    <div id="mortgageResult" class="calc-result"></div>
                </div>
                <div class="card calculator-card">
                    <h3>Fondo de Emergencia</h3>
                    <div class="form-group"><label>Gastos mensuales (‚Ç¨)</label><input type="number" id="calcMonthlyExpenses" step="100"></div>
                    <div class="form-group"><label>Meses de cobertura</label><input type="number" id="monthsCoverage" value="6" step="1"></div>
                    <button class="btn-primary" onclick="calculateEmergencyFund()">Calcular</button>
                    <div id="emergencyFundResult" class="calc-result"></div>
                </div>
                <div class="card calculator-card">
                    <h3>CAGR</h3>
                    <div class="form-group"><label>Valor inicial (‚Ç¨)</label><input type="number" id="initialValue" step="100"></div>
                    <div class="form-group"><label>Valor final (‚Ç¨)</label><input type="number" id="finalValue" step="100"></div>
                    <div class="form-group"><label>A√±os</label><input type="number" id="cagrYears" step="1"></div>
                    <button class="btn-primary" onclick="calculateCAGR()">Calcular</button>
                    <div id="cagrResult" class="calc-result"></div>
                </div>
                <div class="card calculator-card">
                    <h3>Inter√©s Compuesto</h3>
                    <div class="form-group"><label>Capital inicial (‚Ç¨)</label><input type="number" id="ciInitial" step="100"></div>
                    <div class="form-group"><label>Aportaci√≥n mensual (‚Ç¨)</label><input type="number" id="ciMonthly" step="10"></div>
                    <div class="form-group"><label>Inter√©s anual (%)</label><input type="number" id="ciRate" step="0.1"></div>
                    <div class="form-group"><label>A√±os</label><input type="number" id="ciYears" step="1"></div>
                    <button class="btn-primary" onclick="calculateCompoundInterest()">Calcular</button>
                    <div id="ciResult" class="calc-result"></div>
                </div>
            </div>
        </div>

        <!-- DATOS -->
        <div id="datos" class="section">
            <div class="card">
                <h2>Gesti√≥n de Datos</h2>
                <div class="data-section">
                    <h3>Exportar</h3>
                    <p>Descarga un backup</p>
                    <button class="btn-primary" onclick="exportData()">Descargar Backup</button>
                </div>
                <div class="data-section">
                    <h3>Importar</h3>
                    <p>Carga un backup previo</p>
                    <input type="file" id="importFile" accept=".json">
                    <button class="btn-primary" onclick="importData()">Cargar Backup</button>
                </div>
                <div class="data-section danger-zone">
                    <h3>‚ö†Ô∏è Zona Peligrosa</h3>
                    <p>Eliminar√° todos tus datos</p>
                    <button class="btn-danger" onclick="resetData()">Borrar Todo</button>
                </div>
            </div>
        </div>
    </div>

    <!-- NAVEGACI√ìN M√ìVIL INFERIOR -->
    <nav class="mobile-nav">
        <button class="mobile-nav-item active" onclick="showSection('dashboard')" id="mobileNavDashboard">
            <span class="mobile-nav-icon">‚Äî</span>
            Inicio
        </button>
        <button class="mobile-nav-item" onclick="showSection('inversiones')" id="mobileNavInversiones">
            <span class="mobile-nav-icon">‚óá</span>
            Inversi√≥n
        </button>
        <button class="mobile-nav-item" onclick="showSection('estadisticas')" id="mobileNavEstadisticas">
            <span class="mobile-nav-icon">‚ñ¢</span>
            Stats
        </button>
        <button class="mobile-nav-item" onclick="showSection('datos')" id="mobileNavDatos">
            <span class="mobile-nav-icon">‚â°</span>
            Datos
        </button>
    </nav>

    </div> <!-- Cierre app-container -->

    <!-- MODALES -->
    <div id="addTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="transactionModalTitle">Nueva Transacci√≥n</h2>
                <button class="modal-close" onclick="closeModal('addTransactionModal')">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="transactionType">
                <div class="form-group"><label>Mes/A√±o</label><input type="month" id="transactionMonth" required></div>
                <div class="form-group"><label>Monto (‚Ç¨)</label><input type="number" id="transactionAmount" step="0.01" required placeholder="0.00"></div>
                <div class="form-group"><label>Categor√≠a</label><select id="transactionCategory"></select></div>
                <div class="form-group"><label>Cuenta</label><select id="transactionAccount"><option value="Efectivo">Efectivo</option><option value="Cuenta Corriente">Cuenta Corriente</option></select></div>
                <div class="form-group"><label>Descripci√≥n</label><input type="text" id="transactionDescription" placeholder="Opcional..."></div>
                <button class="btn-primary full-width" onclick="saveTransaction()">Guardar</button>
            </div>
        </div>
    </div>

    <div id="editTransactionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Editar Transacci√≥n</h2>
                <button class="modal-close" onclick="closeModal('editTransactionModal')">√ó</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editTransactionId">
                <div class="form-group"><label>Monto (‚Ç¨)</label><input type="number" id="editAmount" step="0.01"></div>
                <div class="form-group"><label>Categor√≠a</label><select id="editCategory"></select></div>
                <div class="form-group"><label>Cuenta</label><select id="editAccount"><option value="Efectivo">Efectivo</option><option value="Cuenta Corriente">Cuenta Corriente</option></select></div>
                <div class="form-group"><label>Descripci√≥n</label><input type="text" id="editDescription"></div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="saveEditedTransaction()">Guardar</button>
                    <button class="btn-danger" onclick="deleteTransaction()">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <div id="detailsModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="detailsTitle">Detalles</h2>
                <button class="modal-close" onclick="closeModal('detailsModal')">√ó</button>
            </div>
            <div class="modal-body" id="detailsContent"></div>
        </div>
    </div>

    <div id="editValueModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2 id="editValueTitle">Editar</h2>
                <button class="modal-close" onclick="closeModal('editValueModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group"><label>Cantidad (‚Ç¨)</label><input type="number" id="editValueInput" step="0.01"></div>
                <button class="btn-primary full-width" onclick="saveEditValue()">Guardar</button>
            </div>
        </div>
    </div>

    <div id="newCategoryModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Nueva Categor√≠a</h2>
                <button class="modal-close" onclick="closeModal('newCategoryModal')">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group"><label>Nombre</label><input type="text" id="newCategoryName" placeholder="Ej: Gimnasio"></div>
                <div class="form-group">
                    <label>Grupo</label>
                    <select id="newCategoryGroup">
                        <option value="basicos">Gastos B√°sicos (20%)</option>
                        <option value="ocio">Ocio (15%)</option>
                        <option value="inversion">Inversi√≥n (65%)</option>
                    </select>
                </div>
                <button class="btn-primary full-width" onclick="saveNewCategory()">A√±adir</button>
            </div>
        </div>
    </div>

    <div id="distributionConfigModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Configurar Distribuci√≥n</h2>
                <button class="modal-close" onclick="closeModal('distributionConfigModal')">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color:var(--text-muted);margin-bottom:20px;">Los porcentajes deben sumar 100%</p>
                <div id="distributionConfigList"></div>
                <button class="btn-primary full-width" style="margin-top:20px;" onclick="saveDistributionConfig()">Guardar</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>